<% if (title) { %>
<h1><%= title %></h1>
<% } else {
  res.redirect('/')
} %>


<%# messages() %>
<% if (errors && errors.array().length > 0) { %>
        <ul class="notice">
            <% errors.array().forEach(error => { %>
                <li><%= error.msg %></li>
                <%  }) %>
            </ul>
            <% } %>


<%- item %>


<section class="reviews-section">
    <h2 class="reviews-title">Customer Reviews</h2>

    <div class="reviews-list">
        <% if (reviews.length > 0) { %>
            <% reviews.forEach(r => { %>
                <div class="review-card">
                    <div class="review-header">
                        <span class="review-author"><%= r.account_firstname %> <%= r.account_lastname %></span>
                        <span class="review-rating">
                            <% for (let i = 1; i <= 5; i++) { %>
                                <% if (i <= r.rating) { %>
                                    ★
                                <% } else { %>
                                    ☆
                                <% } %>
                            <% } %>
                        </span>
                    </div>
                    <p class="review-text"><%= r.review_text %></p>
                </div>
            <% }) %>
        <% } else { %>
            <p class="no-reviews">No reviews yet. Be the first to share your experience!</p>
        <% } %>
    </div>

    <% if (loggedIn) { %>
        <form action="/reviews/add" method="POST" class="review-form">
            <input type="hidden" name="vehicle_id" value="<%= locals.inventory_id %>">

            <div class="form-group">
                <label for="rating">Rating:</label>
                <select name="rating" id="rating" required>
                    <option value="5">★★★★★ (5)</option>
                    <option value="4">★★★★☆ (4)</option>
                    <option value="3">★★★☆☆ (3)</option>
                    <option value="2">★★☆☆☆ (2)</option>
                    <option value="1">★☆☆☆☆ (1)</option>
                </select>
            </div>

            <div class="form-group">
                <label for="review_text">Your Review:</label>
                <textarea name="review_text" id="review_text" rows="4" placeholder="Share your thoughts..." required></textarea>
            </div>

            <button type="submit" class="btn-submit">Submit Review</button>
        </form>
    <% } else { %>
        <p class="login-prompt"><a href="/account/login">Log in</a> to leave a review.</p>
    <% } %>
</section>
